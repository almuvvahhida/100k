{% extends 'base/account-base.html' %}
{% block account_base %}
    {% load static %}
    <head>
        <meta name="theme-color" content="#000000">
        <meta name="description" content="Advertiserlar uchun admin panel">
        <meta name="csrf-token" content="{{ csrf_token }}">
        <link rel="apple-touch-icon" href="https://admin.100k.uz/logo192.png">
        <link rel="manifest" href="https://admin.100k.uz/manifest.json">
        <link rel="stylesheet" href="{% static 'stream_files/all.min.css' %}">
        <link href="{% static 'stream_files/main.bbfc6021.css' %}" rel="stylesheet">
        <link rel="stylesheet" type="text/css" href="{% static 'stream_files/154.45bd50c0.chunk.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static 'stream_files/88.3f709be3.chunk.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static 'stream_files/905.a466c525.chunk.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static 'stream_files/164.8fd4a5f2.chunk.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static 'stream_files/48.01f17801.chunk.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static 'stream_files/379.a6858002.chunk.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static 'stream_files/661.9db8dfee.chunk.css' %}">
        <style data-emotion="css" data-s=""></style>
        <link rel="stylesheet" type="text/css" href="{% static 'stream_files/939.6fbae9ab.chunk.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static 'stream_files/708.13411cd4.chunk.css' %}">
    </head>
    <body>
    <div id="root">
        <div class="app" style="position: relative;">
            <div class="layout">
                <div class="page-wrapper">
                    <main class="page-content" style="position: relative;">
                        <div class="stream">
                            <div class="container">
                                <div class="mantine-1q1idfv"></div>
                                <h1>Mening havolalarim</h1>
                                <div class="mantine-1q1idfv">
                                    <div class="stream__cards">
                                        {% for stream in streams %}
                                            <div class="stream-card">
                                                <div class="stream-card__header">
                                                    <div class="mantine-Badge-root mantine-7io53s"
                                                         style="background-color: rgb(0, 0, 0);">
                                                        <span class="mantine-h9iq4m mantine-Badge-inner">100%</span>
                                                    </div>
                                                    <h2>{{ stream.name|default:"Unnamed Stream" }}</h2>
                                                    <div class="icon">
                                                        <div class="right-bottom">
                                                            <div class="action__delete">
                                                                <svg xmlns="http://www.w3.org/2000/svg"
                                                                     viewBox="0 0 448 512" width="17px"
                                                                     style="cursor: pointer;">
                                                                    <path d="M160 400C160 408.8 152.8 416 144 416C135.2 416 128 408.8 128 400V192C128 183.2 135.2 176 144 176C152.8 176 160 183.2 160 192V400zM240 400C240 408.8 232.8 416 224 416C215.2 416 208 408.8 208 400V192C208 183.2 215.2 176 224 176C232.8 176 240 183.2 240 192V400zM320 400C320 408.8 312.8 416 304 416C295.2 416 288 408.8 288 400V192C288 183.2 295.2 176 304 176C312.8 176 320 183.2 320 192V400zM317.5 24.94L354.2 80H424C437.3 80 448 90.75 448 104C448 117.3 437.3 128 424 128H416V432C416 476.2 380.2 512 336 512H112C67.82 512 32 476.2 32 432V128H24C10.75 128 0 117.3 0 104C0 90.75 10.75 80 24 80H93.82L130.5 24.94C140.9 9.357 158.4 0 177.1 0H270.9C289.6 0 307.1 9.358 317.5 24.94H317.5zM151.5 80H296.5L277.5 51.56C276 49.34 273.5 48 270.9 48H177.1C174.5 48 171.1 49.34 170.5 51.56L151.5 80zM80 432C80 449.7 94.33 464 112 464H336C353.7 464 368 449.7 368 432V128H80V432z"></path>
                                                                </svg>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div class="stream-card__body">
                                                    <form>
                                                        <div class="form-group">
                                                            <label class="form-label" for="input">
                                                                <div>{{ stream.name|default:"Unnamed Stream" }}</div>
                                                            </label>
                                                            <input name="link" type="text" class="form-control"
                                                                   autocomplete="off" maxlength="255"
                                                                   value="{{ request.get_host }}/stream/{{ stream.id }}"
                                                                   disabled>
                                                            <p class="form__error"></p>
                                                        </div>
                                                        <div class="mantine-wadvlz">
                                                            <div class="form-group undefined">
                                                                <div class="form-check">
                                                                    <input class="form-check-input" type="checkbox"
                                                                           id="region-{{ stream.id }}">
                                                                    <label class="form-check-label"
                                                                           for="region-{{ stream.id }}">
                                                                        so'rovlarni hududsiz qabul qilish
                                                                    </label>
                                                                </div>
                                                            </div>
                                                            <div class="form-group mt-10">
                                                                <div class="form-check">
                                                                    <input class="form-check-input" type="checkbox"
                                                                           id="operator-{{ stream.id }}" disabled
                                                                           checked>
                                                                    <label class="form-check-label"
                                                                           for="operator-{{ stream.id }}">
                                                                        Operatorsiz
                                                                    </label>
                                                                </div>
                                                            </div>
                                                            <p class="profit f-c" style="gap: 5px;">
                                                                Foyda: {{ stream.profit|default:0 }} so'm
                                                                <svg width="20" height="20" viewBox="0 0 20 20"
                                                                     fill="none" xmlns="http://www.w3.org/2000/svg">
                                                                    <g opacity="0.7" clip-path="url(#clip0)">
                                                                        <path d="M9.99935 18.3333C5.39685 18.3333 1.66602 14.6025 1.66602 10C1.66602 5.39751 5.39685 1.66667 9.99935 1.66667C14.6018 1.66667 18.3327 5.39751 18.3327 10C18.3327 14.6025 14.6018 18.3333 9.99935 18.3333ZM9.16602 9.16667V14.1667H10.8327V9.16667H9.16602ZM9.16602 5.83334V7.5H10.8327V5.83334H9.16602Z"
                                                                              fill="#293462"/>
                                                                    </g>
                                                                    <defs>
                                                                        <clipPath id="clip0">
                                                                            <rect width="20" height="20" fill="white"/>
                                                                        </clipPath>
                                                                    </defs>
                                                                </svg>
                                                            </p>
                                                        </div>
                                                        <p class="mb-10" style="text-align: end;">
                                                            {{ stream.created_at|default:"13.05.2025 21:44:26" }}
                                                        </p>
                                                    </form>
                                                </div>
                                                <div class="stream-card__footer bt pt-20 f-c-sb">
                                                    <button type="button" class="btn btn-primary copy-link-btn"
                                                            data-link="{{ request.scheme }}://{{ request.get_host }}/stream/{{ stream.id }}">
                                                        Nusxa ko'chirish
                                                    </button>
                                                    <button type="button" class="btn btn-default">
                                                        <i class="fa-solid fa-file-import"></i>
                                                    </button>
                                                </div>
                                            </div>
                                        {% empty %}
                                            <p>Oqim mavjud emas.</p>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>

                            <!-- Pagination -->
                            <div class="pagination">
                                <div class="display-records">
                                    <p>Ko'rsatilgan ma'lumotlar: 1-{{ streams|length }} jami {{ streams|length }}</p>
                                </div>
                                <ul role="navigation" aria-label="Pagination">
                                    <li class="previous disabled">
                                        <a class=" " tabindex="-1" role="button" aria-disabled="true"
                                           aria-label="Previous page" rel="prev">
                                        <span class="pagination__prev">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">
                                                <path d="M362.7 203.9l-159.1 144c-6.125 5.469-15.31 5.469-21.44 0L21.29 203.9C14.73 197.1 14.2 187.9 20.1 181.3C26.38 174.4 36.5 174.5 42.73 180.1L192 314.5l149.3-134.4c6.594-5.877 16.69-5.361 22.62 1.188C369.8 187.9 369.3 197.1 362.7 203.9z"/>
                                            </svg>
                                        </span>
                                        </a>
                                    </li>
                                    <li class="selected">
                                        <a rel="canonical" role="button" tabindex="-1"
                                           aria-label="Page 1 is your current page" aria-current="page">1</a>
                                    </li>
                                    <li class="next disabled">
                                        <a class=" " tabindex="-1" role="button" aria-disabled="true"
                                           aria-label="Next page" rel="next">
                                        <span class="pagination__next">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512">
                                                <path d="M362.7 203.9l-159.1 144c-6.125 5.469-15.31 5.469-21.44 0L21.29 203.9C14.73 197.1 14.2 187.9 20.1 181.3C26.38 174.4 36.5 174.5 42.73 180.1L192 314.5l149.3-134.4c6.594-5.877 16.69-5.361 22.62 1.188C369.8 187.9 369.3 197.1 362.7 203.9z"/>
                                            </svg>
                                        </span>
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </main>
                </div>
            </div>
        </div>
        <div style="position: fixed; z-index: 9999; inset: 16px; pointer-events: none;"></div>
    </div>
    <div id="modal">
        <div class="modal close modal-import">
            <div class="modal__overlay"></div>
            <div class="modal__content">
                <div class="modal__box">
                    <div class="modal__header"><p class="modal__title">Targetdan tushgan leadlarni import qilish</p>
                        <div style="padding: 10px;">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"
                                 class="select-modal__close-icon" style="cursor: pointer;">
                                <path d="M376.6 84.5c11.3-13.6 9.5-33.8-4.1-45.1s-33.8-9.5-45.1 4.1L192 206 56.6 43.5C45.3 29.9 25.1 28.1 11.5 39.4S-3.9 70.9 7.4 84.5L150.3 256 7.4 427.5c-11.3 13.6-9.5 33.8 4.1 45.1s33.8 9.5 45.1-4.1L192 306 327.4 468.5c11.3 13.6 31.5 15.4 45.1 4.1s15.4-31.5 4.1-45.1L233.7 256 376.6 84.5z"></path>
                            </svg>
                        </div>
                    </div>
                    <form class="p-20">
                        <div class="ticket-form-group">
                            <label class="ticket-form-label" for="select">Facebookdan olingan .csv faylni
                                yuklang</label>
                            <div class="ticket-form-upload">
                                <p class="placeholder">csv faylni tanlang</p>
                                <input class="bg-input" type="file" accept=".xlsx, .xls, .csv">
                            </div>
                            <p class="form__error"></p>
                        </div>
                        <div class="f-c-e g-10 mt-10">
                            <button class="mantine-UnstyledButton-root mantine-Button-root mantine-8nr514" type="submit"
                                    data-button="true">
                                <div class="mantine-3xbgk5 mantine-Button-inner"><span
                                        class="mantine-qo1k2 mantine-Button-label">Jo'natish</span></div>
                            </button>
                            <button class="mantine-UnstyledButton-root mantine-Button-root mantine-1is15mz"
                                    type="button" data-button="true">
                                <div class="mantine-3xbgk5 mantine-Button-inner"><span
                                        class="mantine-qo1k2 mantine-Button-label">Bekor qilish</span></div>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        <div class="modal close modal-import-success">
            <div class="modal__overlay"></div>
            <div class="modal__content">
                <div class="modal__box">
                    <div class="modal__header"><p class="modal__title"></p>
                        <div style="padding: 10px;">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"
                                 class="select-modal__close-icon" style="cursor: pointer;">
                                <path d="M376.6 84.5c11.3-13.6 9.5-33.8-4.1-45.1s-33.8-9.5-45.1 4.1L192 206 56.6 43.5C45.3 29.9 25.1 28.1 11.5 39.4S-3.9 70.9 7.4 84.5L150.3 256 7.4 427.5c-11.3 13.6-9.5 33.8 4.1 45.1s33.8 9.5 45.1-4.1L192 306 327.4 468.5c11.3 13.6 31.5 15.4 45.1 4.1s15.4-31.5 4.1-45.1L233.7 256 376.6 84.5z"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="p-20">
                        <div class="mantine-Alert-root mantine-18rvduv" id="mantine-r0" role="alert"
                             aria-labelledby="mantine-r0-title" aria-describedby="mantine-r0-body">
                            <div class="mantine-17do188 mantine-Alert-wrapper">
                                <div class="mantine-soroux mantine-Alert-icon"><i class="fa-solid fa-circle-check"
                                                                                  style="font-size: 30px; display: block;"></i>
                                </div>
                                <div class="mantine-1eawhj0 mantine-Alert-body">
                                    <div class="mantine-e546sj mantine-Alert-title"><span id="mantine-r0-title"
                                                                                          class="mantine-194kea0 mantine-Alert-label">Leadlar muvaffaqiyatli yuklandi</span>
                                    </div>
                                    <div id="mantine-r0-body" class="mantine-twh6oi mantine-Alert-message"></div>
                                </div>
                            </div>
                        </div>
                        <div class="center">
                            <button class="mantine-UnstyledButton-root mantine-Button-root mt-10 mantine-1sy6mp7"
                                    type="button" data-button="true">
                                <div class="mantine-3xbgk5 mantine-Button-inner"><span
                                        class="mantine-qo1k2 mantine-Button-label">Yopish</span></div>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="modal close undefined">
            <div class="modal__overlay"></div>
            <div class="modal__content">
                <div class="modal__box">
                    <div class="modal__header"><p class="modal__title">Oqimni o'chirish</p>
                        <div style="padding: 10px;">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"
                                 class="select-modal__close-icon" style="cursor: pointer;">
                                <path d="M376.6 84.5c11.3-13.6 9.5-33.8-4.1-45.1s-33.8-9.5-45.1 4.1L192 206 56.6 43.5C45.3 29.9 25.1 28.1 11.5 39.4S-3.9 70.9 7.4 84.5L150.3 256 7.4 427.5c-11.3 13.6-9.5 33.8 4.1 45.1s33.8 9.5 45.1-4.1L192 306 327.4 468.5c11.3 13.6 31.5 15.4 45.1 4.1s15.4-31.5 4.1-45.1L233.7 256 376.6 84.5z"></path>
                            </svg>
                        </div>
                    </div>
                    <div class="modal-confirm">
                        <div>Siz rostdan ham ushbu oqimni o'chirmoqchimisiz?</div>
                        <div class="btn-group">
                            <button class="mantine-UnstyledButton-root mantine-Button-root btn btn-primary mantine-8nr514"
                                    type="button" data-button="true">
                                <div class="mantine-3xbgk5 mantine-Button-inner"><span
                                        class="mantine-qo1k2 mantine-Button-label">Tasdiqlash</span></div>
                            </button>
                            <span>yoki</span>
                            <button type="button" class="btn btn-cencel">Bekor qilish</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            document.querySelector('.stream__cards').addEventListener('click', function (event) {
                const button = event.target.closest('.copy-link-btn');
                if (!button) return;

                const link = button.getAttribute('data-link');
                if (!link) {
                    alert("Nusxalash uchun havola topilmadi.");
                    return;
                }

                if (navigator.clipboard) {
                    navigator.clipboard.writeText(link).then(() => {
                        alert("Havola nusxa qilindi: " + link);
                    }).catch(err => {
                        console.error('Clipboard API error:', err);
                        fallbackCopy(link);
                    });
                } else {
                    fallbackCopy(link);
                }
            });
            function fallbackCopy(text) {
                try {
                    const textArea = document.createElement('textarea');
                    textArea.value = text;
                    textArea.style.position = 'fixed';
                    textArea.style.opacity = '0';
                    document.body.appendChild(textArea);
                    textArea.focus();
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    alert("Havola nusxa qilindi: " + text);
                } catch (err) {
                    alert("Xatolik yuz berdi: " + err);
                }
            }
        });
    </script>
    <script>
        document.querySelectorAll('.action__delete svg').forEach((btn) => {
            btn.addEventListener('click', function () {
                const card = btn.closest('.stream-card');
                const streamId = card.querySelector('input[name="link"]').value.split('/').pop();

                if (confirm("Rostdan ham ushbu oqimni o‘chirmoqchimisiz?")) {
                    fetch(`/stream/delete/${streamId}/`, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': '{{ csrf_token }}',
                        },
                    })
                        .then(res => {
                            if (res.ok) {
                                card.remove();
                            } else {
                                alert("O‘chirishda xatolik yuz berdi.");
                            }
                        })
                        .catch(err => {
                            alert("Internetga ulanishda xatolik yoki server javob bermayapti.");
                        });
                }
            });
        });
    </script>

    <div id="select-menus"></div>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=es5%2Ces6%2Ces7%2CString.prototype.replaceAll%2CSymbol.replace"></script>
    <script src="{% static 'stream_files/script.js' %}"></script>
    </body>
{% endblock %}